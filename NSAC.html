<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enigma Machine Simulator</title>
<style>
body {
  font-family: "Courier New", monospace;
  background: #0b0c10;
  color: #66fcf1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
}
h1 {
  color: #45a29e;
}
.container {
  background: #1f2833;
  padding: 30px;
  border-radius: 12px;
  box-shadow: 0 0 20px #45a29e55;
  width: 90%;
  max-width: 600px;
  text-align: center;
}
label, select, input, textarea {
  margin: 8px;
}
textarea {
  width: 100%;
  height: 120px;
  resize: none;
  background: #0b0c10;
  color: #66fcf1;
  border: 1px solid #45a29e;
  border-radius: 8px;
  padding: 10px;
}
button {
  background: #45a29e;
  color: #0b0c10;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
}
button:hover {
  background: #66fcf1;
}
.output {
  background: #0b0c10;
  color: #45a29e;
  border-radius: 8px;
  padding: 10px;
  margin-top: 10px;
  white-space: pre-wrap;
}
</style>
</head>
<body>
  <div class="container">
    <h1>üïµÔ∏è Enigma Machine Simulator</h1>
    <p>Type a message, choose starting rotor positions, and encrypt/decrypt!</p>

    <label>Rotor Positions (A‚ÄìZ):</label><br>
    <input id="pos1" maxlength="1" value="A" size="1">
    <input id="pos2" maxlength="1" value="A" size="1">
    <input id="pos3" maxlength="1" value="A" size="1">

    <br><br>
    <textarea id="inputText" placeholder="Enter text..."></textarea><br>
    <button onclick="encryptMessage()">Encrypt / Decrypt</button>

    <div class="output" id="outputText"></div>
  </div>

<script>
const ALPH = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

// Standard WWII Enigma I‚ÄìII‚ÄìIII + Reflector B
const ROTORS = {
  I:   { wiring: "EKMFLGDQVZNTOWYHXUSPAIBRCJ", notch: "Q" },
  II:  { wiring: "AJDKSIRUXBLHWTMCQGZNPYFVOE", notch: "E" },
  III: { wiring: "BDFHJLCPRTXVZNYEIWGAKMUSQO", notch: "V" }
};
const REFLECTOR = "YRUHQSLDPXNGOKMIEBFZCWVJAT";

function rotateLetter(c, n) {
  return ALPH[(ALPH.indexOf(c) + n + 26) % 26];
}

class Rotor {
  constructor(wiring, notch, pos) {
    this.wiring = wiring;
    this.inverse = ALPH.split("").map(c => ALPH[this.wiring.indexOf(c)]).join("");
    this.notch = notch;
    this.position = pos;
  }
  step() { this.position = rotateLetter(this.position, 1); }
  atNotch() { return this.position === this.notch; }

  forward(c) {
    const off = ALPH.indexOf(this.position);
    const idx = (ALPH.indexOf(c) + off) % 26;
    const out = this.wiring[idx];
    return rotateLetter(out, -off);
  }
  backward(c) {
    const off = ALPH.indexOf(this.position);
    const idx = (ALPH.indexOf(c) + off) % 26;
    const out = this.inverse[idx];
    return rotateLetter(out, -off);
  }
}

function encryptMessage() {
  const txt = document.getElementById("inputText").value.toUpperCase().replace(/[^A-Z]/g, "");
  const pos1 = document.getElementById("pos1").value.toUpperCase() || "A";
  const pos2 = document.getElementById("pos2").value.toUpperCase() || "A";
  const pos3 = document.getElementById("pos3").value.toUpperCase() || "A";

  const left = new Rotor(ROTORS.I.wiring, ROTORS.I.notch, pos1);
  const mid  = new Rotor(ROTORS.II.wiring, ROTORS.II.notch, pos2);
  const right= new Rotor(ROTORS.III.wiring, ROTORS.III.notch, pos3);

  let out = "";
  for (let c of txt) {
    // Rotor stepping
    if (mid.atNotch()) { left.step(); mid.step(); }
    else if (right.atNotch()) { mid.step(); }
    right.step();

    // Forward
    let ch = right.forward(c);
    ch = mid.forward(ch);
    ch = left.forward(ch);

    // Reflector
    ch = REFLECTOR[ALPH.indexOf(ch)];

    // Backward
    ch = left.backward(ch);
    ch = mid.backward(ch);
    ch = right.backward(ch);

    out += ch;
  }

  document.getElementById("outputText").textContent = "Ciphertext:\n" + out;
}
</script>
</body>
</html>
